# Учет истории посещенных хостов

Каждый хост предобрабатываем:
1. сплит по точке (разбиваем на уровни доменных имен)
2. оставляем только первые 3 уровня для каждого хоста

Итого получаем колонки domain_level_3 domain_level_2 domain_level_1

Отбираем 127 наиболее часто посещаемых хостов для каждого пользователя по числу реквестов
sum(request_cnt)
group by user_id, domain_level_3, domain_level_2, domain_level_1 
order by user_id, request_cnt, domain_level_3, domain_level_2, domain_level_1

Итого имеем для каждого user_id список из 127 (или меньше) хостов, которые он посещал

Эмбединг урла = concat(emb(domain_level_3), emb(domain_level_2), emb(domain_level_1))
В начало лепим CLS-токен
Урлы сортируем по убыванию кол-ва запросов + накидываем positional embedding
Прогоняем через 1-2 слоя берта и берем вектор, соответствующий CLS-токену – закодированная история пользователя

# Учет другой инфы
Эмбедим географию (топ-регион, топ-город)
Эмбедим устройство (производитель, модель)

# Голова
конкат эмбеддингов географии, устройства и истории
поверх несколько полносвязных слоев

Все сдабриваем леернормами
